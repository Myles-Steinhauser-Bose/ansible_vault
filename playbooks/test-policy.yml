---

- hosts: 127.0.0.1
  connection: local
  gather_facts: False
  become: False
  vars_files:
    - ../group_vars/vault

  tasks:
    - include: test-vault-credentials.yml

#    - name: Create policy (using policy arguement)
#      vault_policy:
#        token: "{{ vault_token }}"
#        tls: off
#        state: present
#        policy_name: 'test_policy'
#        path: 'secret/*'
#        policy: 'read'
#
#    - name: Create policy (using capabilities arguement)
#      vault_policy:
#        token: "{{ vault_token }}"
#        tls: off
#        state: present
#        policy_name: 'test_policy2'
#        path: 'secret/*'
#        capabilities:
#          - 'create'
#          - 'sudo'

    - name: Remove policy
      vault_policy:
        token: "{{ vault_token }}"
        tls: off
        state: absent
        policy_name: 'test_policy'

    - name: Remove policy (should be no changes)
      vault_policy:
        token: "{{ vault_token }}"
        tls: off
        state: absent
        policy_name: 'test_policy'
